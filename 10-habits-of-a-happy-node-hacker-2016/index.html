<!doctype html><html><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><title>10 Habits of a Happy Node Hacker 2016</title><meta content="Learn, create, share, enjoy, and feel." name=description><link rel="shortcut icon" href=/favicon.ico><link href=https://unpkg.com/minireset.css@0.0.7/minireset.css rel=stylesheet><link href=https://unpkg.com/firacode@6.2.0/distr/fira_code.css rel=stylesheet><link href=https://fundon.viz.rs/index.css rel=stylesheet><link href=https://fundon.viz.rs/atom.xml rel=alternate title=RSS type=application/atom+xml><body><script async>function toggle() {
        let classList = document.querySelector('html').classList;
        if (classList.contains('dark-theme')) {
          classList.remove('dark-theme')
          classList.add('sepia-theme')
          localStorage.setItem('theme-mode', 'sepia')
        } else if (classList.contains('sepia-theme')) {
          classList.remove('sepia-theme')
          localStorage.removeItem('theme-mode')
        } else {
          classList.add('dark-theme')
          localStorage.setItem('theme-mode', 'dark')
        }
      }
      try {
        let mode = localStorage.getItem('theme-mode');
        if (mode) {
          document.querySelector('html').classList.add(`${mode}-theme`)
        }
      } catch (e) {}</script><nav class=navbar><div class=container><div class=navbar-brand><a class=logo href=https://fundon.viz.rs> <img - src=https://fundon.viz.rs/logo.png> </a></div><ul class=social><li><a href=https://github.com/fundon> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg> </a><li><a href=https://fosstodon.org/@fundon> <svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><g fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M18.648 15.254C16.832 17.017 12 16.88 12 16.88a18.262 18.262 0 0 1-3.288-.256c1.127 1.985 4.12 2.81 8.982 2.475c-1.945 2.013-13.598 5.257-13.668-7.636L4 10.309c0-3.036.023-4.115 1.352-5.633C7.023 2.766 12 3.01 12 3.01s4.977-.243 6.648 1.667C19.977 6.195 20 7.274 20 10.31s-.456 4.074-1.352 4.944z"/><path d="M12 11.204V8.278C12 7.02 11.105 6 10 6S8 7.02 8 8.278V13m4-4.722C12 7.02 12.895 6 14 6s2 1.02 2 2.278V13"/></g></svg> </a><li><a href=https://twitter.com/_fundon> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path></svg> </a><li><a href=https://fundon.viz.rs/tags/> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"></path><path d="M7 7h.01"></path></svg> </a><li><a href=https://fundon.viz.rs/atom.xml> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a><li><button class=toggle><span class=sun> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><circle cx=12 cy=12 r=4></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg> </span> <span class=moon> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M12 3a6.364 6.364 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg> </span> <span class=coffee> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M17 8h1a4 4 0 1 1 0 8h-1"></path><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"></path><line x1=6 x2=6 y1=2 y2=4></line><line x1=10 x2=10 y1=2 y2=4></line><line x1=14 x2=14 y1=2 y2=4></line></svg> </span></button></ul></div></nav><header class=header><div class=container><h1 class=header-title>10 Habits of a Happy Node Hacker 2016</h1><div class=header-meta><span class=header-meta-author>Fangdun Tsai</span><time class=header-meta-date> December 12th, 2015 </time></div><ul class=header-meta-tags><li><a href=https://fundon.viz.rs/tags/translation/>Translation</a> <li><a href=https://fundon.viz.rs/tags/node/>Node</a> <li><a href=https://fundon.viz.rs/tags/npm/>NPM</a> <li><a href=https://fundon.viz.rs/tags/javascript/>JavaScript</a> </ul></div></header><main class="content container"><article class=post><div class=post-content><p class=post-description><p>原文：<a href=https://blog.heroku.com/archives/2015/11/10/node-habits-2016>10 Habits of a Happy Node Hacker (2016)</a> by Hunter<p>在 2015 年底，JavaScript 开发者周边已经充斥了很多工具，供他们支配使用。 <a href=https://blog.heroku.com/archives/2014/3/11/node-habits>上次</a>我们已经观察了这个问题，现代 JS 的兴起。今天，我们很容易迷失在这巨大的生态系统中， 所以成功的团队都需要遵循指南，使他们的时间和项目保存健康。<p>这 10 个习惯很适合即将进入 2016 的 Node.js 黑客。 它们真对的是应用开发者，而不是模块作者，因为这些群体有不同的目标和约束：<h2 id=1-shi-yong-npm-init-kai-shi-mei-ge-xin-xiang-mu>1. 使用 <code>npm init</code> 开始每个新项目</h2><p>NPM <code>init</code> 命令将为你的项目生成一个有效的 <code>package.json</code> 文件， 从工作目录中自动推到出一些常见属性。<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> mkdir my-awesome-app</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cd my-awesome-app</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> npm init<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>yes</span></span>
</span></code></pre><p>我比较懒，所以我使用了 <code>--yes</code> 标志去执行它，然后打开 package.json 做些修改。 第一件事你应该指定一个 <code>engines</code> 关键词，使用你当前的 node 版本（<code>node -v</code>）。<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>engines<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>: <span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>node<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>4.2.1<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
<span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></code></pre><h2 id=2-shi-yong-yi-ge-zhi-neng-de-npmrc-pei-zhi>2. 使用一个智能的 <code>.npmrc</code> 配置</h2><p>默认地，npm 不会保存已经安装的依赖到 package.json（所以你总是需要追踪你的依赖！）。<p>如果你使用 <code>--save</code> 标志去自动更新 package.json，npm 安装这些包会以 <code>^</code> 开头，会导致你的 模块在不同版本之间漂移。这对模块开发没问题，但对应用不好， 如果你想要在所有的环境之间保持一致的依赖关系。<p>一个解决方案是像这样安装包：<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> npm install foobar<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>save</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>save-exact</span></span>
</span></code></pre><p>更胜一筹的，你可以把这些选项添加到 <code>~/.npmrc</code> 中，更新你的默认设置：<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> npm config set save=true</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> npm config set save-exact=true</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cat <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>/.npmrc</span>
</span></code></pre><p>现在，<code>npm install foobar</code> 将会自动添加 <code>foobar</code> 到 package.json 并且你的依赖不会在安装时产生偏移!<p>如果你更喜欢在 package.json 中保持弹性依赖，但仍然需要在生产环境中锁住依赖的话，你或者可以 生成 <a href=https://docs.npmjs.com/cli/shrinkwrap>npm's shrinkwrap</a> 到你的工作流中。这需要花费更多的精力，但是还是很多好处的，保持 准确的版本的嵌套依赖关系。<h2 id=3-kuai-tiao-shang-es6-huo-che-ba>3. 快跳上 ES6 火车吧！</h2><p>Node 4+ 携带了一个 <a href=https://nodejs.org/en/blog/release/v4.0.0/>V8 引擎的更新</a>，拥有几个有用的 <a href=https://nodejs.org/en/docs/es6/>ES6 特性</a>。 不要害怕，并不是一些复杂的东西，你可以轻松学习它。有许多简单的改进，让人满意。<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">let</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">user</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-variable z-other z-object z-ts">users</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-ts">find</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-arrow z-ts"><span class="z-variable z-parameter z-ts">u</span> </span><span class="z-meta z-arrow z-ts"><span class="z-storage z-type z-function z-arrow z-ts">=></span> </span><span class="z-variable z-other z-object z-ts">u</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-variable z-property z-dom z-ts">id</span> <span class="z-keyword z-operator z-comparison z-ts">===</span> <span class="z-variable z-other z-constant z-ts">ID</span><span class="z-meta z-brace z-round z-ts">)</span></span>

<span class="z-meta z-function-call z-ts"><span class="z-support z-class z-console z-ts">console</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-console z-ts">log</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-template z-ts"><span class="z-punctuation z-definition z-string z-template z-begin z-ts">`</span>Hello, <span class="z-meta z-template z-expression z-ts"><span class="z-punctuation z-definition z-template-expression z-begin z-ts">${</span></span><span class="z-meta z-template z-expression z-ts"><span class="z-meta z-embedded z-line z-ts"><span class="z-variable z-other z-object z-ts">user</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-variable z-property z-dom z-ts">name</span></span><span class="z-punctuation z-definition z-template-expression z-end z-ts">}</span></span>!<span class="z-punctuation z-definition z-string z-template z-end z-ts">`</span></span><span class="z-meta z-brace z-round z-ts">)</span>
</span></code></pre><h2 id=4-jian-chi-shi-yong-xiao-xie>4. 坚持使用小写</h2><p>一些语言鼓励文件名匹配类名，比如 <code>MyClass</code> 和 <code>MyClass.js</code>。在 Node 中， 不要那样做。而是使用文件名小写的方式：<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">let</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">MyClass</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-meta z-function-call z-ts"><span class="z-support z-function z-ts">require</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>my-class<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span><span class="z-meta z-brace z-round z-ts">)</span></span>
</span></code></pre><p>Node.js 是一个罕见的范例，Linux-centric 化工具，但跨平台支持又多。 当在 OSX 和 Windows 平台时，对待 <code>myclass.js</code> 和 <code>MyClass.js</code> 是一样的， Linux 不会。如果要编写可在这些平台移植的代码，你就需要明确匹配 <code>require</code> 中的声明，包括大写。<p>一个简单正确的方式，就是一切都使用文件名小写的方式。例如 <code>my-class.js</code>。<blockquote><p>译者：其实 Mac OSX 也可以设置文件系统 case-sensitive。</blockquote><h2 id=5-cluster-ni-de-ying-yong>5. Cluster 你的应用</h2><p>自从 node 运行时被限制在单核 CPU 和大约 1.5 GB 的内存之后， 部署一个无 clustered 模式的 node 应用在一个大型服务器上是一个对资源巨大的浪费。<p>要想利用多核和内存超过 1.5 GB 的话，把支持 <a href=https://nodejs.org/api/cluster.html>Cluster</a> 烧尽你的应用。 即使如果今天你仅仅把单个进程运行在小硬件上，在未来 Cluster 也会带给你足够的灵活。<p>测试是最好的方式，弄清楚你的应用理想的 clustered 进程数， 但最好根据你的平台提出一个<a href=https://devcenter.heroku.com/articles/node-concurrency>合理的默认值</a>，可以有个简单的备选。 比如：<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">const</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-constant z-ts">CONCURRENCY</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-support z-variable z-object z-process z-ts">process</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-variable z-property z-process z-ts">env</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-variable z-other z-constant z-property z-ts">WEB_CONCURRENCY</span> <span class="z-keyword z-operator z-logical z-ts">||</span> <span class="z-constant z-numeric z-decimal z-ts">1</span></span>
</span></code></pre><p>选择一个 <a href="https://www.npmjs.com/search?q=cluster">Cluster abstraction</a> 可以避免重复造（进程管理的）轮子。如果你喜欢分开 <code>master</code> 和 <code>worker</code> 文件，可以试试 <a href=https://www.npmjs.com/package/forky>forky</a>。 如果你更喜欢单个入口文件和函数的话， 看看这个 <a href=https://www.npmjs.com/package/throng>throng</a>。<h2 id=6-you-huan-jing-yi-shi>6. 有环境意识</h2><p>不要在你的项目中乱扔具体环境配置文件！而应该使用环境变量。<p>首选，安装 <a href=https://github.com/strongloop/node-foreman>node-foreman</a>：<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> npm install<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>save</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>save-exact</span> foreman</span>
</span></code></pre><p>然后，创建一个 <a href=https://devcenter.heroku.com/articles/procfile>Procfile</a> 文件，声明你的应用的进程类型：<pre class=z-code><code><span class="z-text z-plain">web: bin/web
worker: bin/worker
</span></code></pre><p>现在，你就可以使用 <code>nf</code> 程序启动你的应用<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>scripts<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>: <span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>start<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>nf start<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
<span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></code></pre><p>要支持本地开发环境，可以创建 <code>.gitignore</code> 文件，把 <code>.env</code> 文件加入进来。 使用 node-foreman 时，<code>.env</code> 文件将会被加载进来：<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">DATABASE_URL</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>postgres://localhost/foobar<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
<span class="z-variable z-other z-readwrite z-assignment z-shell">HTTP_TIMEOUT</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">10000</span>
</span></code></pre><p>现在，一个简单的命令（<code>npm start</code>）将会使 <code>web</code> 和 <code>worker</code> 进程在那个环境下 同时运转起来。然后，当你部署你的项目时，它会在新的主机上自动适应这些环境变量。<p>比起 <code>config/abby-dev.js</code>、<code>config/brian-dev.js</code>，<code>config/qa1.js</code>、 <code>config/qa2.js</code>、<code>config/prod.js</code>，这个更加简单灵活。<h2 id=7-bi-mian-la-ji-hui-shou>7. 避免垃圾回收</h2><p>Node（V8）使用一个懒惰、贪婪的垃圾回收。它默认被限制在大约 1.5 GB。 在回收无用内存前，它有时会等待，直到它彻底回收这些无用内存。如果你的内存使用不断增加， 它可能不是内存泄漏，反而是 <a href=https://github.com/nodejs/node/issues/3370#issuecomment-148108323>node 通常的懒惰行为</a>。<p>要想对你应用的垃圾回收获得更多的控制，你可以在你的 <code>Procfile</code> 文件中给 V8 添加一些标志：<pre class=z-code><code><span class="z-text z-plain">web: node --optimize_for_size --max_old_space_size=920 --gc_interval=100 server.js
</span></code></pre><p>这个尤其重要，如果你的应用是运行在一个少于 1.5 GB 内存的环境上。 例如，你想要把 node 调整到一个 512 MB 的容器上，试试这个：<pre class=z-code><code><span class="z-text z-plain">web: node --optimize_for_size --max_old_space_size=460 --gc_interval=100 server.js
</span></code></pre><h2 id=8-ba-shi-qing-lian-jie-qi-lai>8. 把事情链接起来</h2><p>Npm 的<a href=https://docs.npmjs.com/misc/scripts>生命周期脚本</a> 可以为自动化创建丰富的钩子。如果你需要在构建你的应用之前运行一些东西， 你可以使用 <code>preinstall</code> 脚本。如果想使用 grunt、gulp、browserify 或者 webpack 构建 assets 呢？那就使用 <code>postinstall</code> 脚本。<p>在 package.json 中：<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>scripts<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>: <span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>postinstall<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>bower install && grunt build<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>start<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>nf start<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
<span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></code></pre><p>你也可以使用环境变量去控制这些脚本：<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>postinstall<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>: <span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>if $BUILD_ASSETS; then npm run build-assets; fi<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>,
<span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>build-assets<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>: <span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>bower install && grunt build<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
</span></code></pre><p>如果你的脚本想在外面进行控制的话，把它们移到相应的文件：<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>postinstall<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>: <span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>scripts/postinstall.sh<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
</span></code></pre><p>由于 <code>./node_modules/.bin</code> 会被自动添加到环境变量 <code>PATH</code> 上，在 package.json 中的脚本 会从上面去寻找，所以你可以直接执行它们，就像 <code>bower</code> 或者 <code>wepack</code>。<h2 id=9-jin-git-zhong-yao-de-bu-fen>9. 仅 git 重要的部分</h2><p>大多数的应用是由必要的文件和生成文件组成。当使用一个版本控制系统像 git 时，你应该避免对生成的 任何文件都进行追踪。<p>例如，你的 node 应用可能会有一个 <code>node_modules</code> 依赖目录，这个你应该<a href=https://docs.npmjs.com/misc/faq#should-i-check-my-node-modules-folder-into-git>避免 git 控制</a>。 只要每个依赖都列在 package.json 文件中，任何人都可以创建一个你的应用的工作副本，包括 <code>node_modules</code> － 在运行 <code>npm install</code> 后。<p>追踪这些生成文件，将会导致你的 git 历史充斥着无用的声音和臃肿。这是非常糟糕的，自从有些依赖是 原生并且需要被编译时，检查它们将使你的应用缺少便捷性，因为你将需要提供多个编译版本， 但却只从一个、可能是不正确的环境中生成。<p>同样的原因，你也不应该检查 <code>bower_components</code> 或者由 grunt 编译生成的 assets。<p>如果你之前已经不慎检查了 <code>node_modules</code> 目录，没关系，你可以删掉它，像这样：<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> echo <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>node_modules<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">>></span> .gitignore</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> git rm<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>r</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>cached</span> node_modules</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> git commit<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>am</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>ignore node_modules<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span></code></pre><p>我也忽略了 npm 的 logs 文件，所以它们不会搞乱我的代码：<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> echo <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>npm-debug.log<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">>></span> .gitignore</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> git commit<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>am</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>ignore npm-debug<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span></code></pre><p>忽略了这些无用的文件，你的仓库将会更加的小，你的提交将会更加简单， 并且你将避免合并这些因生成目录而导致的分歧。<h2 id=10-jian-yue>10. 简约</h2><p>技术预测是不准确的，但我还是会预测下即将到来的一年，2016 将是 JavaScript 简化的一年。<p>越来越多的开发者正在简化它们的架构。为替换庞大的 MVCs 框架，他们正在使用<a href=https://medium.com/swlh/scaling-on-the-cheap-933e46944886#.2lvubkyhm>静态化的前端构建项目</a>， 这样可以部署在 CDN 上，且使用一个 Node.js API 提供动态数据。<p>我们也开始看到了复杂的构建系统对我们项目的阻力。一些前沿的开发者正在简化他们的构建系统。例如， 使用一个 <code>vanilla</code> 构建系统，没有 <a href=https://medium.com/@tarkus/you-might-not-need-gulp-js-89a0220487dd#.etiox78kw>bower、gulp 或者 grunt</a>。<p>最终，我们将简化我们的代码在 2016。有时，这来自删除功能， 就像 <a href="https://www.youtube.com/watch?v=bo36MrBfTk4">Douglas Crockford's "The Better Parts"</a>。 其他，这来自添加功能 － 就像我喜欢的 callback 的替代物 <a href=https://thomashunter.name/blog/the-long-road-to-asyncawait-in-javascript/>async-await</a>。 Async-await 在 Node 中还不能用，但今天你可以借助牛逼的 <a href=http://babeljs.io/docs/usage/cli/#babel-node>Babeljs</a> 项目使用它。<p>不要把看到那么多工具和框架一次性都挤进你的项目，试着去简化你的工作。<h2 id=ni-de-xi-guan-shi-shi-yao>你的习惯是什么？</h2><p>我试着在我的所有项目中遵从这些习惯。不管你是 <a href=https://devcenter.heroku.com/articles/getting-started-with-nodejs#introduction>node 新人</a>还是服务端 JS 老手，我确定你会为 自己开发一些技巧。我们非常欢迎听到它们！使用 <a href="https://twitter.com/search?f=tweets&vertical=default&q=%23node_habits&src=typd">#node_habits</a> 标签，分享你的习惯！<p>Happy hacking!<p>本文由 fundon 翻译，未经许可，不得转载。</div></article></main><footer class=footer><div class=container><div class=heart><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a>  20114-PRESENT © Fangdun Tsai   <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z"></path></svg></div><div class=power>Powered By <a href=https://www.getzola.org/>Zola</a> & <a href=https://vercel.com/design>Design</a></div></div></footer><script>document.querySelector('button.toggle').onclick = toggle</script>