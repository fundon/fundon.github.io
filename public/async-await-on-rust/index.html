<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Fangdun Cai" />
    <title> Async-await on Rust - é”ˆå‡ºæœªæ¥ </title>
    <meta
      name="description"
      content="ç”Ÿå‘½ç¬¬ N æ¬¡ç»ƒä¹ ï¼Œè°¢å¤©åœ°èµæˆ‘é€†å¢ƒï¼"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/minireset.css@0.0.6/minireset.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/firacode@2.0.0/distr/fira_code.css"
    />
    <link rel="stylesheet" href="https:&#x2F;&#x2F;fundon.me&#x2F;index.css" />
    <link rel='alternate' type='application/rss+xml' href="https:&#x2F;&#x2F;fundon.me&#x2F;rss.xml" />
  </head>
  <body>
  <script async="">
      window.isDark = false
      function toggle() {
        if (document.querySelector('html').classList.toggle('dark-theme')) {
          localStorage.setItem('dark-mode', true)
        } else {
          localStorage.removeItem('dark-mode')
        }
      }
      try {
        if (localStorage.getItem('dark-mode')) {
          toggle()
          window.isDark = true
        }
      } catch (e) {}
    </script>
    <nav class="navbar">
      <div class="container">
        <div class="navbar-brand">
          <a class="logo" href="https:&#x2F;&#x2F;fundon.me">
            <img src="https:&#x2F;&#x2F;avatars2.githubusercontent.com&#x2F;u&#x2F;27926?s=400&amp;v=4" />
          </a>
        </div>
        <ul class="social">
          <li>
            <a href="https://github.com/fundon">
               <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision">
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"/>
</svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/_fundon">
               <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision">
  <path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/>
</svg>
            </a>
          </li>
          <li>
            <a href="mailto:cfddream@gmail.com">
               <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision">
  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
  <path d="M22 6l-10 7L2 6"/>
</svg>
            </a>
          </li>
          <li>
            <a href="https:&#x2F;&#x2F;fundon.me&#x2F;tags&#x2F;">
               <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision">
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/>
  <path d="M7 7h.01"/>
</svg>
            </a>
          </li>
          <li>
            <a href="https:&#x2F;&#x2F;fundon.me&#x2F;rss.xml">
               <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision">
  <path d="M4 11a9 9 0 019 9"/>
  <path d="M4 4a16 16 0 0116 16"/>
  <circle cx="5" cy="19" r="1"/>
</svg>
            </a>
          </li>
          <li>
            <button class="toggle">
              <span class="sun">
               <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision">
  <circle cx="12" cy="12" r="5"/>
  <path d="M12 1v2"/>
  <path d="M12 21v2"/>
  <path d="M4.22 4.22l1.42 1.42"/>
  <path d="M18.36 18.36l1.42 1.42"/>
  <path d="M1 12h2"/>
  <path d="M21 12h2"/>
  <path d="M4.22 19.78l1.42-1.42"/>
  <path d="M18.36 5.64l1.42-1.42"/>
</svg>
              </span>
              <span class="moon">
               <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision">
  <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
</svg>
              </span>
            </button>
          </li>
        </ul>
      </div>
    </nav>

    <header class="header">
      <div class="container">
        <h1 class="header-title">
           Async-await on Rust 
        </h1>
        <div class="header-meta">
          <span class="header-meta-author">Fangdun Cai</span>
           
  <time class="header-meta-date">
    December  4th, 2019
  </time>

        </div>
         
  
  <ul class="header-meta-tags">  
    
    <li>
      <a href="https://fundon.me/tags/async-await/">Async-await</a>&nbsp;
    </li>
    
    <li>
      <a href="https://fundon.me/tags/rust/">Rust</a>&nbsp;
    </li>
    
    <li>
      <a href="https://fundon.me/tags/javascript/">JavaScript</a>&nbsp;
    </li>
    
    <li>
      <a href="https://fundon.me/tags/web/">Web</a>&nbsp;
    </li>
    
  </ul>
  

        
      </div>
    </header>

    <main class="content container">
      
<article class="post">
  <div class="post-content">
    <p class="post-description">
      åœ¨å¼‚æ­¥ä¸–ç•Œä¸­æ¢ç´¢
    </p>
    <p>å¼‚æ­¥æ“ä½œï¼Œå¯¹ <strong>JavaScript</strong> å¼€å‘è€…æ¥è¯´å·²ç»å±äºæ—¥å¸¸æ“ä½œï¼Œå®¶å¸¸ä¾¿é¥­ã€‚
ä» <code>Callback</code> åˆ° <code>Promise</code> å†åˆ° <code>Async-await</code>ï¼Œä¸€è·¯æ‘†è„±äº† <code>Callback Hell</code>ã€<code>Promise Chain</code>ï¼Œ
<code>Async-await</code> ä¸ºå·¥ç¨‹å¼€å‘å¸¦æ¥äº†æå¤§ä¾¿åˆ©ï¼Œç®€ç›´æ˜¯ç¥å…µåˆ©å™¨ã€‚</p>
<p><strong>Rust</strong> åœ¨ <strong><a href="https://blog.rust-lang.org/2019/11/07/Rust-1.39.0.html">1.39.0</a></strong> ç¨³å®šç‰ˆä¸­å¼•å…¥äº†æœŸå¾…å·²ä¹…çš„ <code>Async-await</code> è¯­æ³•ç³–ï¼Œè¿™æ˜¯ä¸€ä¸ªä¼Ÿå¤§çš„é‡Œç¨‹ç¢‘ï¼ŒğŸ¦€ ç»ˆäºå¯ä»¥æ„‰å¿«åœ°çˆ¬è¡Œäº†ã€‚</p>
<p>ä¸ç®¡æ˜¯ <strong>JavaScript</strong> ç‰ˆè¿˜æ˜¯ <strong>Rust</strong> ç‰ˆæœ¬ï¼Œä¸¤åˆ™åœ¨è®¾è®¡ä¸Šè¿˜æ˜¯å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œå¯ä»¥æ¢ç´¢ä¸€ç•ªã€‚</p>
<h3 id="javascript">JavaScript</h3>
<ul>
<li>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/AsyncFunction">AsyncFunction</a>ï¼šç”¨æ¥åˆ›å»ºæ–°çš„å¼‚æ­¥å‡½æ•°å¯¹è±¡</p>
</li>
<li>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>ï¼šå¯¹è±¡ç”¨äºè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆå®Œæˆ (æˆ–å¤±è´¥)ï¼ŒåŠå…¶ç»“æœå€¼</p>
<ul>
<li><code>pending</code>ï¼šåˆå§‹çŠ¶æ€ï¼Œæ—¢ä¸æ˜¯æˆåŠŸï¼Œä¹Ÿä¸æ˜¯å¤±è´¥çŠ¶æ€</li>
<li><code>fulfilled</code>ï¼šæ„å‘³ç€æ“ä½œæˆåŠŸå®Œæˆ</li>
<li><code>rejected</code>ï¼šæ„å‘³ç€æ“ä½œå¤±è´¥</li>
</ul>
</li>
</ul>
<p>å¯ä»¥é€šè¿‡ <code>async function</code> æ¥å£°æ˜ä¸€ä¸ª <code>AsyncFunction</code>ï¼Œå½“æ‰§è¡Œè¿™ä¸ª <code>AsyncFunction()</code> æ—¶ï¼Œ
ä¼šè¿”å›ä¸€ä¸ª <code>Promise</code>ï¼Œç„¶åå†æ‰§è¡Œ <code>await Promise</code> æ“ä½œï¼Œç»è¿‡è®¡ç®—åï¼Œå°±å¯ä»¥è·å¾—æœ€ç»ˆç»“æœã€‚</p>
<pre style="background-color:#282a36;">
<span style="font-style:italic;color:#8be9fd;">async function </span><span style="color:#50fa7b;">get</span><span style="color:#f8f8f2;">() </span><span style="color:#ffffff;">{
  </span><span style="color:#ff79c6;">return </span><span style="color:#f1fa8c;">&#39;Hello Async-await&#39;
</span><span style="color:#ffffff;">}

</span><span style="font-style:italic;color:#8be9fd;">async function </span><span style="color:#50fa7b;">main</span><span style="color:#f8f8f2;">() </span><span style="color:#ffffff;">{
  </span><span style="font-style:italic;color:#8be9fd;">let </span><span style="color:#ffffff;">result </span><span style="color:#ff79c6;">= await </span><span style="color:#50fa7b;">get</span><span style="color:#f8f8f2;">()
  </span><span style="font-style:italic;color:#66d9ef;">console</span><span style="color:#ff79c6;">.</span><span style="color:#8be9fd;">log</span><span style="color:#f8f8f2;">(</span><span style="color:#ffffff;">result</span><span style="color:#f8f8f2;">)
</span><span style="color:#ffffff;">}

</span><span style="color:#50fa7b;">main</span><span style="color:#f8f8f2;">()
</span></pre><h3 id="rust">Rust</h3>
<ul>
<li>
<p><a href="https://doc.rust-lang.org/std/future/trait.Future.html">Future</a>ï¼šç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥è®¡ç®—</p>
</li>
<li>
<p><a href="https://doc.rust-lang.org/beta/std/task/enum.Poll.html">Poll</a>ï¼šç±»ä¼¼ <strong>JavaScript</strong> ä¸­çš„ <code>Promise</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹</p>
<ul>
<li><code>Ready&lt;T&gt;</code>ï¼šè¡¨ç¤ºç»“æœå·²ç»è®¡ç®—å®Œæ¯•ï¼Œå‡†å¤‡å¦¥å½“ï¼Œå¯ä»¥ç«‹åˆ»è¿”å›</li>
<li><code>Pending</code>ï¼šç­‰å¾…çŠ¶æ€ï¼Œä»»åŠ¡è¿›è¡Œä¸­ï¼Œè¿˜åœ¨è®¡ç®—ï¼Œç»“æœå‡†å¤‡ä¸­</li>
</ul>
</li>
</ul>
<p>å¯ä»¥é€šè¿‡ <code>async fn</code>ï¼Œå£°æ˜ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œå½“æ‰§è¡Œè¿™ä¸ªå¼‚æ­¥æ–¹æ³• <code>fn()</code> æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ª <code>Future</code>ï¼Œç„¶ååœ¨æ‰§è¡Œ <code>Future.await</code> æ“ä½œï¼Œ
åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡ï¼Œæ­¤æ—¶å†…éƒ¨çœŸæ­£æ‰§è¡Œçš„æ˜¯ <code>Future.poll()</code>ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª <code>Poll</code>ï¼Œç»è¿‡è®¡ç®—åï¼Œå°±å¯ä»¥è·å¾—æœ€ç»ˆç»“æœã€‚</p>
<h4 id="xiao-tie-shi">å°è´´å£«</h4>
<ul>
<li>
<p>å¦‚æœä¸€ä¸ªå¼‚æ­¥æ–¹æ³•æœ‰è¿”å›ç»“æœ <code>T</code>ï¼Œåˆ™ç›¸åº”çš„ï¼Œæ‰§è¡Œ <code>fn()</code> æ—¶ï¼Œè¿”å›çš„æ˜¯ <code>Future&lt;Output = T&gt;</code>ã€‚</p>
</li>
<li>
<p>å› ä¸ºè¿”å›ç»“æœ <code>T</code> æ˜¯ä¸€ä¸ªèŒƒå‹ï¼Œå¯ä»¥åœ¨ <code>Future.await</code> åé¢åŠ ä¸Š <code>?</code> æ“ä½œç¬¦ï¼Œ<code>Future.await?</code>ï¼Œå®ƒä¼šæŠŠç»“æœè½¬åŒ–æˆ <code>Result&lt;T, E&gt;</code>ï¼Œ
æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥è½»æ¾åˆ¤æ–­æˆåŠŸæˆ–å¤±è´¥ï¼Œè¿™å°±ä¸ <strong>JavaScript</strong> ä¸­çš„ <code>Promise#fulfilled</code> å’Œ <code>Promise#rejected</code> å¼‚æ›²åŒå·¥ã€‚</p>
</li>
</ul>
<pre style="background-color:#282a36;">
<span style="color:#ff79c6;">use </span><span style="text-decoration:underline;color:#66d9ef;">async_std</span><span style="text-decoration:underline;color:#ff79c6;">::</span><span style="color:#f8f8f2;">task;

async </span><span style="font-style:italic;color:#8be9fd;">fn </span><span style="color:#50fa7b;">get</span><span style="color:#f8f8f2;">() </span><span style="color:#ff79c6;">-&gt; String </span><span style="color:#ffffff;">{
    </span><span style="color:#f1fa8c;">&quot;Hello Async-await&quot;</span><span style="color:#ff79c6;">.</span><span style="color:#8be9fd;">to_owned</span><span style="color:#f8f8f2;">()
</span><span style="color:#ffffff;">}

</span><span style="font-style:italic;color:#8be9fd;">fn </span><span style="color:#50fa7b;">main</span><span style="color:#f8f8f2;">() </span><span style="color:#ffffff;">{
    </span><span style="text-decoration:underline;color:#66d9ef;">task</span><span style="text-decoration:underline;color:#ff79c6;">::</span><span style="color:#f8f8f2;">block_on(async </span><span style="color:#ffffff;">{
        </span><span style="font-style:italic;color:#8be9fd;">let</span><span style="color:#f8f8f2;"> result </span><span style="color:#ff79c6;">= </span><span style="color:#8be9fd;">get</span><span style="color:#f8f8f2;">()</span><span style="color:#ff79c6;">.</span><span style="color:#f8f8f2;">await;
        println!(</span><span style="color:#f1fa8c;">&quot;</span><span style="color:#bd93f9;">{}</span><span style="color:#f1fa8c;">&quot;</span><span style="color:#f8f8f2;">, result);
    </span><span style="color:#ffffff;">}</span><span style="color:#f8f8f2;">);
</span><span style="color:#ffffff;">}
</span></pre><h3 id="zong-jie">æ€»ç»“</h3>
<p>ä»¥ä¸Šåˆ†æä¸¤ç§è¯­è¨€åœ¨ <code>Async-await</code> çš„è®¾è®¡ã€æ‰§è¡Œæµç¨‹ï¼Œåœ¨å®ç°ä¸Šæœ‰å¾ˆå¤šç›¸è¯†ä¹‹å¤„ï¼Œå¦‚æœä¹‹å‰æœ‰ <strong>JavaScript</strong> å¼€å‘ç»éªŒï¼Œåˆ™å¯ä»¥è½»æ¾åœ°è¿‡æ¸¡åˆ° <strong>Rust</strong> ä¸­ã€‚</p>
<p>æ€»ä¹‹è®©æˆ‘ä»¬ ğŸ¦€ æ„‰å¿«çš„çˆ¬èµ·æ¥ã€‚</p>

  </div>
</article>

    </main>

    <footer class="footer">
      <div class="container">
        <div class="heart">
          Made with&nbsp;&nbsp; <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" shape-rendering="geometricPrecision" style="color:var(--geist-foreground);--geist-fill:currentColor;--geist-stroke:var(--geist-background)">
  <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" fill="var(--geist-fill)"/>
</svg>&nbsp;&nbsp; Â© Fangdun Cai  2019
        </div>
        <div class="power">
          Powered By <a href="https://www.getzola.org/">Zola</a> & <a href="https://zeit.co/">Zeit</a> & <a href="https://zeit.co/design">Design</a>
        </div>
      </div>
    </footer>

    <script>
      document.querySelector('button.toggle').onclick = toggle
    </script>
  </body>
</html>
