<!doctype html><html><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><title>Async-await on Rust</title><meta content="Learn, create, share, enjoy, and feel." name=description><link rel="shortcut icon" href=/favicon.ico><link href=https://unpkg.com/minireset.css@0.0.7/minireset.css rel=stylesheet><link href=https://unpkg.com/firacode@6.2.0/distr/fira_code.css rel=stylesheet><link href=https://fundon.viz.rs/index.css rel=stylesheet><link href=https://fundon.viz.rs/atom.xml rel=alternate title=RSS type=application/atom+xml><body><script async>function toggle() {
        let classList = document.querySelector('html').classList;
        if (classList.contains('dark-theme')) {
          classList.remove('dark-theme')
          classList.add('sepia-theme')
          localStorage.setItem('theme-mode', 'sepia')
        } else if (classList.contains('sepia-theme')) {
          classList.remove('sepia-theme')
          localStorage.removeItem('theme-mode')
        } else {
          classList.add('dark-theme')
          localStorage.setItem('theme-mode', 'dark')
        }
      }
      try {
        let mode = localStorage.getItem('theme-mode');
        if (mode) {
          document.querySelector('html').classList.add(`${mode}-theme`)
        }
      } catch (e) {}</script><nav class=navbar><div class=container><div class=navbar-brand><a class=logo href=https://fundon.viz.rs> <img - src=https://fundon.viz.rs/logo.png> </a></div><ul class=social><li><a href=https://github.com/fundon> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg> </a><li><a href=https://fosstodon.org/@fundon> <svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><g fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M18.648 15.254C16.832 17.017 12 16.88 12 16.88a18.262 18.262 0 0 1-3.288-.256c1.127 1.985 4.12 2.81 8.982 2.475c-1.945 2.013-13.598 5.257-13.668-7.636L4 10.309c0-3.036.023-4.115 1.352-5.633C7.023 2.766 12 3.01 12 3.01s4.977-.243 6.648 1.667C19.977 6.195 20 7.274 20 10.31s-.456 4.074-1.352 4.944z"/><path d="M12 11.204V8.278C12 7.02 11.105 6 10 6S8 7.02 8 8.278V13m4-4.722C12 7.02 12.895 6 14 6s2 1.02 2 2.278V13"/></g></svg> </a><li><a href=https://twitter.com/_fundon> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path></svg> </a><li><a href=https://fundon.viz.rs/tags/> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"></path><path d="M7 7h.01"></path></svg> </a><li><a href=https://fundon.viz.rs/atom.xml> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a><li><button class=toggle><span class=sun> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><circle cx=12 cy=12 r=4></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg> </span> <span class=moon> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M12 3a6.364 6.364 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg> </span> <span class=coffee> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M17 8h1a4 4 0 1 1 0 8h-1"></path><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"></path><line x1=6 x2=6 y1=2 y2=4></line><line x1=10 x2=10 y1=2 y2=4></line><line x1=14 x2=14 y1=2 y2=4></line></svg> </span></button></ul></div></nav><header class=header><div class=container><h1 class=header-title>Async-await on Rust</h1><div class=header-meta><span class=header-meta-author>Fangdun Tsai</span><time class=header-meta-date> December 4th, 2019 </time></div><ul class=header-meta-tags><li><a href=https://fundon.viz.rs/tags/async-await/>Async-await</a>Â <li><a href=https://fundon.viz.rs/tags/rust/>Rust</a>Â <li><a href=https://fundon.viz.rs/tags/javascript/>JavaScript</a>Â <li><a href=https://fundon.viz.rs/tags/web/>Web</a>Â </ul></div></header><main class="content container"><article class=post><div class=post-content><p class=post-description>åœ¨å¼‚æ­¥ä¸–ç•Œä¸­æ¢ç´¢<p>å¼‚æ­¥æ“ä½œï¼Œå¯¹ <strong>JavaScript</strong> å¼€å‘è€…æ¥è¯´å·²ç»å±äºæ—¥å¸¸æ“ä½œï¼Œå®¶å¸¸ä¾¿é¥­ã€‚ ä» <code>Callback</code> åˆ° <code>Promise</code> å†åˆ° <code>Async-await</code>ï¼Œä¸€è·¯æ‘†è„±äº† <code>Callback Hell</code>ã€<code>Promise Chain</code>ï¼Œ <code>Async-await</code> ä¸ºå·¥ç¨‹å¼€å‘å¸¦æ¥äº†æå¤§ä¾¿åˆ©ï¼Œç®€ç›´æ˜¯ç¥å…µåˆ©å™¨ã€‚<p><strong>Rust</strong> åœ¨ <strong><a href=https://blog.rust-lang.org/2019/11/07/Rust-1.39.0.html>1.39.0</a></strong> ç¨³å®šç‰ˆä¸­å¼•å…¥äº†æœŸå¾…å·²ä¹…çš„ <code>Async-await</code> è¯­æ³•ç³–ï¼Œè¿™æ˜¯ä¸€ä¸ªä¼Ÿå¤§çš„é‡Œç¨‹ç¢‘ï¼ŒğŸ¦€ ç»ˆäºå¯ä»¥æ„‰å¿«åœ°çˆ¬è¡Œäº†ã€‚<p>ä¸ç®¡æ˜¯ <strong>JavaScript</strong> ç‰ˆæœ¬è¿˜æ˜¯ <strong>Rust</strong> ç‰ˆæœ¬ï¼Œä¸¤åˆ™åœ¨è®¾è®¡ä¸Šè¿˜æ˜¯å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œå¯ä»¥æ¢ç´¢ä¸€ç•ªã€‚<h3 id=javascript>JavaScript</h3><ul><li><p><a href=https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/AsyncFunction>AsyncFunction</a>ï¼šç”¨æ¥åˆ›å»ºæ–°çš„å¼‚æ­¥å‡½æ•°å¯¹è±¡</p><li><p><a href=https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise>Promise</a>ï¼šå¯¹è±¡ç”¨äºè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆå®Œæˆ (æˆ–å¤±è´¥)ï¼ŒåŠå…¶ç»“æœå€¼</p> <ul><li><code>pending</code>ï¼šåˆå§‹çŠ¶æ€ï¼Œæ—¢ä¸æ˜¯æˆåŠŸï¼Œä¹Ÿä¸æ˜¯å¤±è´¥çŠ¶æ€<li><code>fulfilled</code>ï¼šæ„å‘³ç€æ“ä½œæˆåŠŸå®Œæˆ<li><code>rejected</code>ï¼šæ„å‘³ç€æ“ä½œå¤±è´¥</ul></ul><p>å¯ä»¥é€šè¿‡ <code>async function</code> æ¥å£°æ˜ä¸€ä¸ª <code>AsyncFunction</code>ï¼Œå½“æ‰§è¡Œè¿™ä¸ª <code>AsyncFunction()</code> æ—¶ï¼Œ ä¼šè¿”å›ä¸€ä¸ª <code>Promise</code>ï¼Œç„¶åå†æ‰§è¡Œ <code>await Promise</code> æ“ä½œï¼Œç»è¿‡è®¡ç®—åï¼Œå°±å¯ä»¥è·å¾—æœ€ç»ˆç»“æœã€‚<pre class="language-js z-code" data-lang=js><code class=language-js data-lang=js><span class="z-source z-ts"><span class="z-meta z-function z-ts"><span class="z-storage z-modifier z-async z-ts">async</span> <span class="z-storage z-type z-function z-ts">function</span> <span class="z-meta z-definition z-function z-ts"><span class="z-entity z-name z-function z-ts">get</span></span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-keyword z-control z-flow z-ts">return</span> <span class="z-string z-quoted z-single z-ts"><span class="z-punctuation z-definition z-string z-begin z-ts">'</span>Hello Async-await<span class="z-punctuation z-definition z-string z-end z-ts">'</span></span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span>

<span class="z-meta z-function z-ts"><span class="z-storage z-modifier z-async z-ts">async</span> <span class="z-storage z-type z-function z-ts">function</span> <span class="z-meta z-definition z-function z-ts"><span class="z-entity z-name z-function z-ts">main</span></span><span class="z-meta z-parameters z-ts"><span class="z-punctuation z-definition z-parameters z-begin z-ts">(</span><span class="z-punctuation z-definition z-parameters z-end z-ts">)</span></span> <span class="z-meta z-block z-ts"><span class="z-punctuation z-definition z-block z-ts">{</span>
  <span class="z-meta z-var z-expr z-ts"><span class="z-storage z-type z-ts">let</span> <span class="z-meta z-var-single-variable z-expr z-ts"><span class="z-meta z-definition z-variable z-ts"><span class="z-variable z-other z-readwrite z-ts">result</span></span> </span><span class="z-keyword z-operator z-assignment z-ts">=</span> <span class="z-keyword z-control z-flow z-ts">await</span> <span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">get</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-brace z-round z-ts">)</span></span>
  <span class="z-meta z-function-call z-ts"><span class="z-support z-class z-console z-ts">console</span><span class="z-punctuation z-accessor z-ts">.</span><span class="z-support z-function z-console z-ts">log</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-variable z-other z-readwrite z-ts">result</span><span class="z-meta z-brace z-round z-ts">)</span>
<span class="z-punctuation z-definition z-block z-ts">}</span></span></span>

<span class="z-meta z-function-call z-ts"><span class="z-entity z-name z-function z-ts">main</span></span><span class="z-meta z-brace z-round z-ts">(</span><span class="z-meta z-brace z-round z-ts">)</span>
</span></code></pre><h3 id=rust>Rust</h3><ul><li><p><a href=https://doc.rust-lang.org/std/future/trait.Future.html>Future</a>ï¼šç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥è®¡ç®—</p><li><p><a href=https://doc.rust-lang.org/beta/std/task/enum.Poll.html>Poll</a>ï¼šç±»ä¼¼ <strong>JavaScript</strong> ä¸­çš„ <code>Promise</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ <code>Poll&LTT></code></p> <ul><li><code>Ready&LTT></code>ï¼šè¡¨ç¤ºç»“æœå·²ç»è®¡ç®—å®Œæ¯•ï¼Œå‡†å¤‡å¦¥å½“ï¼Œå¯ä»¥ç«‹åˆ»è¿”å›<li><code>Pending</code>ï¼šç­‰å¾…çŠ¶æ€ï¼Œä»»åŠ¡è¿›è¡Œä¸­ï¼Œè¿˜åœ¨è®¡ç®—ï¼Œç»“æœå‡†å¤‡ä¸­</ul></ul><p>å¯ä»¥é€šè¿‡ <code>async fn</code>ï¼Œå£°æ˜ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œå½“æ‰§è¡Œè¿™ä¸ªå¼‚æ­¥æ–¹æ³• <code>fn()</code> æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ª <code>Future</code>ï¼Œç„¶åå†æ‰§è¡Œ <code>Future.await</code> æ“ä½œï¼Œ åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡ï¼Œæ­¤æ—¶å†…éƒ¨çœŸæ­£æ‰§è¡Œçš„æ˜¯ <code>Future.poll()</code>ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª <code>Poll</code>ï¼Œç»è¿‡è®¡ç®—åï¼Œå°±å¯ä»¥è·å¾—æœ€ç»ˆç»“æœã€‚<h4 id=xiao-tie-shi>å°è´´å£«</h4><ul><li><p>å¦‚æœä¸€ä¸ªå¼‚æ­¥æ–¹æ³•æœ‰è¿”å›ç»“æœ <code>T</code>ï¼Œåˆ™ç›¸åº”çš„ï¼Œæ‰§è¡Œ <code>fn()</code> æ—¶ï¼Œè¿”å›çš„æ˜¯ <code>Future&LTOutput = T></code>ã€‚</p><li><p>å› ä¸ºè¿”å›ç»“æœ <code>T</code> æ˜¯ä¸€ä¸ªèŒƒå‹ï¼Œå¯ä»¥åœ¨ <code>Future.await</code> åé¢åŠ ä¸Š <code>?</code> æ“ä½œç¬¦ï¼Œ<code>Future.await?</code>ï¼Œå®ƒä¼šæŠŠç»“æœè½¬åŒ–æˆ <code>Result&LTT, E></code>ï¼Œ æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥è½»æ¾åˆ¤æ–­æˆåŠŸæˆ–å¤±è´¥ï¼Œè¿™å°±ä¸ <strong>JavaScript</strong> ä¸­çš„ <code>Promise#fulfilled</code> å’Œ <code>Promise#rejected</code> å¼‚æ›²åŒå·¥ã€‚</p></ul><pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">async_std<span class="z-punctuation z-accessor z-rust">::</span></span>task<span class="z-punctuation z-terminator z-rust">;</span>

async <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">get</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> String</span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
    <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Hello Async-await<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">to_owned</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>

<span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">main</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
    <span class="z-meta z-path z-rust">task<span class="z-punctuation z-accessor z-rust">::</span></span>block_on<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>async <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
        <span class="z-storage z-type z-rust">let</span> result <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-support z-function z-rust">get</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span>await<span class="z-punctuation z-terminator z-rust">;</span>
        <span class="z-support z-macro z-rust">println!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span><span class="z-constant z-other z-placeholder z-rust">{}</span><span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-separator z-rust">,</span> result<span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><h3 id=zong-jie>æ€»ç»“</h3><p>ä»¥ä¸Šåˆ†æä¸¤ç§è¯­è¨€åœ¨ <code>Async-await</code> çš„è®¾è®¡ã€æ‰§è¡Œæµç¨‹ï¼Œåœ¨å®ç°ä¸Šæœ‰å¾ˆå¤šç›¸è¯†ä¹‹å¤„ï¼Œå¦‚æœä¹‹å‰æœ‰ <strong>JavaScript</strong> å¼€å‘ç»éªŒï¼Œåˆ™å¯ä»¥è½»æ¾åœ°è¿‡æ¸¡åˆ° <strong>Rust</strong> ä¸­ã€‚<p>æ€»ä¹‹è®©æˆ‘ä»¬ ğŸ¦€ æ„‰å¿«åœ°çˆ¬èµ·æ¥ã€‚</div></article></main><footer class=footer><div class=container><div class=heart><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a>Â Â 20114-PRESENT Â© Fangdun TsaiÂ Â  <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z"></path></svg></div><div class=power>Powered By <a href=https://www.getzola.org/>Zola</a> & <a href=https://vercel.com/design>Design</a></div></div></footer><script>document.querySelector('button.toggle').onclick = toggle</script>